pipeline {
  agent any

  environment {
    VAULT_ADDR = 'http://172.17.0.2:8200'
    ROLE_ID=credentials("ROLE_ID")
  }

  stages {
    stage ('Compile Stage') {
      steps {
        sh "SECRET_ID=\$(vault write -force auth/approle/role/jenkins_deployer/secret-id -format=json | jq -r ."data" | jq -r ."secret_id")"
        sh "VAULT_TOKEN=\$(vault write auth/approle/login role_id=$ROLE_ID} secret_id=$SECRET_ID -format=json | jq -r ."auth" | jq -r ."client_token")"
        sh "echo Test"
      }
    }
  }

  
}
